"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var nativescript_angular_1 = require("nativescript-angular");
var moment = require("moment");
var app_constant_1 = require("~/app.constant");
require("rxjs/add/operator/map");
var api_1 = require("~/shared/api");
nativescript_angular_1.registerElement("PullToRefresh", function () { return require("nativescript-pulltorefresh").PullToRefresh; });
var SearchResultComponent = /** @class */ (function () {
    function SearchResultComponent(route, router, bookingService, routerExtensions) {
        var _this = this;
        this.route = route;
        this.router = router;
        this.bookingService = bookingService;
        this.routerExtensions = routerExtensions;
        this.busy = false;
        this.searchCriteria = {};
        this.total = 0;
        this.paging = {
            pageIndex: 0,
            pageSize: 10,
        };
        this.listData = [];
        this.searchInfo = {
            searching: false,
            timeElapsed: '',
            startTimeReq: 0
        };
        this.subscription = this.route.queryParams.subscribe(function (e) {
            _this.searchCriteria = e || {};
        });
    }
    SearchResultComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.search(this.searchCriteria).subscribe(function (resp) {
            _this.listData = resp;
        }, function () {
        });
    };
    SearchResultComponent.prototype.search = function (model, noReload) {
        var _this = this;
        if (!noReload) {
            this.busy = true;
        }
        this.searchInfo.startTimeReq = +(new Date());
        var arrivalDate = +moment(+model.arrivalDate) || +moment(model.arrivalDate);
        var departureDate = +moment(+model.departureDate) || +moment(model.departureDate);
        return this.bookingService.bookingSearchProperties(moment(arrivalDate).format(app_constant_1.default.typeFormat.date), moment(departureDate).format(app_constant_1.default.typeFormat.date), model.numberOfPAX, '', '0', true, this.paging.pageIndex + 1, this.paging.pageSize)
            .map(function (resp) {
            if (!noReload) {
                _this.busy = false;
            }
            _this.searchInfo.searching = false;
            _this.searchInfo.timeElapsed = (((+new Date()) - _this.searchInfo.startTimeReq) / 1000).toFixed(2);
            _this.searchInfo.startTimeReq = 0;
            _this.total = resp.data.total;
            _this.listData = resp.data.entities.concat(resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities, resp.data.entities);
            return resp.data.entities;
        }, function () {
            _this.searchInfo.searching = false;
            _this.searchInfo.timeElapsed = (((+new Date()) - _this.searchInfo.startTimeReq) / 1000).toFixed(2);
            _this.searchInfo.startTimeReq = 0;
        });
    };
    SearchResultComponent.prototype.goBack = function () {
        this.routerExtensions.backToPreviousPage();
    };
    SearchResultComponent.prototype.onItemTap = function (args) {
        var selectedItem = this.listData[args.index];
        this.router.navigate(['hotel-detail'], {
            queryParams: tslib_1.__assign({}, this.searchCriteria, { id: selectedItem.id })
        });
    };
    SearchResultComponent.prototype.ngOnDestroy = function () {
        this.subscription && this.subscription.unsubscribe();
        if (global.android) {
            global.gc();
        }
    };
    SearchResultComponent.prototype.onPullToRefreshInitiated = function (args) {
        var _this = this;
        var listView = args.object;
        this.search(this.searchCriteria, true).subscribe(function (resp) {
            _this.listData = resp;
            listView.notifyPullToRefreshFinished();
        }, function () {
            listView.notifyPullToRefreshFinished();
        });
    };
    SearchResultComponent = tslib_1.__decorate([
        core_1.Component({
            selector: 'search-result-component',
            moduleId: module.id,
            templateUrl: './search-result.component.html',
        }),
        tslib_1.__metadata("design:paramtypes", [router_1.ActivatedRoute,
            router_1.Router,
            api_1.BookingService,
            nativescript_angular_1.RouterExtensions])
    ], SearchResultComponent);
    return SearchResultComponent;
}());
exports.SearchResultComponent = SearchResultComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXJlc3VsdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzZWFyY2gtcmVzdWx0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxzQ0FBb0Y7QUFDcEYsMENBQXlEO0FBQ3pELDZEQUF5RTtBQUN6RSwrQkFBaUM7QUFDakMsK0NBQXlDO0FBQ3pDLGlDQUErQjtBQUMvQixvQ0FBOEM7QUFDOUMsc0NBQWUsQ0FBQyxlQUFlLEVBQUMsY0FBTSxPQUFBLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLGFBQWEsRUFBbkQsQ0FBbUQsQ0FBQyxDQUFDO0FBTzNGO0lBZ0JJLCtCQUFvQixLQUFxQixFQUNyQixNQUFjLEVBQ2QsY0FBOEIsRUFDOUIsZ0JBQWtDO1FBSHRELGlCQVFDO1FBUm1CLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQ3JCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQWpCL0MsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUNiLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLFVBQUssR0FBRyxDQUFDLENBQUM7UUFDVixXQUFNLEdBQUc7WUFDWixTQUFTLEVBQUUsQ0FBQztZQUNaLFFBQVEsRUFBRSxFQUFFO1NBQ2YsQ0FBQztRQUNLLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDZCxlQUFVLEdBQUc7WUFDaEIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsV0FBVyxFQUFFLEVBQUU7WUFDZixZQUFZLEVBQUUsQ0FBQztTQUNsQixDQUFDO1FBTUUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBQyxDQUFDO1lBQ25ELEtBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVsQyxDQUFDLENBQUMsQ0FBQTtJQUNO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O1lBQ2xELEtBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1FBQzNDLENBQUMsRUFBRTtZQUNDLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQWhHUSxxQkFBcUI7UUFMakMsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSx5QkFBeUI7WUFDbkMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSxnQ0FBZ0M7U0FDaEQsQ0FBQztpREFpQjZCLHVCQUFjO1lBQ2IsZUFBTTtZQUNFLG9CQUFjO1lBQ1osdUNBQWdCO09BbkI3QyxxQkFBcUIsQ0FpR2pDO0lBQUQsNEJBQUM7Q0FBQSxBQWpHRCxJQWlHQztBQWpHWSxzREFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgcmVnaXN0ZXJFbGVtZW50LCBSb3V0ZXJFeHRlbnNpb25zIH0gZnJvbSAnbmF0aXZlc2NyaXB0LWFuZ3VsYXInO1xuaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgQXBwQ29uc3RhbnQgZnJvbSAnfi9hcHAuY29uc3RhbnQnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xuaW1wb3J0IHsgQm9va2luZ1NlcnZpY2UgfSBmcm9tICd+L3NoYXJlZC9hcGknO1xucmVnaXN0ZXJFbGVtZW50KFwiUHVsbFRvUmVmcmVzaFwiLCgpID0+IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcHVsbHRvcmVmcmVzaFwiKS5QdWxsVG9SZWZyZXNoKTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdzZWFyY2gtcmVzdWx0LWNvbXBvbmVudCcsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2VhcmNoLXJlc3VsdC5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaFJlc3VsdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBwdWJsaWMgc3Vic2NyaXB0aW9uO1xuICAgIHB1YmxpYyBidXN5ID0gZmFsc2U7XG4gICAgcHVibGljIHNlYXJjaENyaXRlcmlhID0ge307XG4gICAgcHVibGljIHRvdGFsID0gMDtcbiAgICBwdWJsaWMgcGFnaW5nID0ge1xuICAgICAgICBwYWdlSW5kZXg6IDAsXG4gICAgICAgIHBhZ2VTaXplOiAxMCxcbiAgICB9O1xuICAgIHB1YmxpYyBsaXN0RGF0YSA9IFtdO1xuICAgIHB1YmxpYyBzZWFyY2hJbmZvID0ge1xuICAgICAgICBzZWFyY2hpbmc6IGZhbHNlLFxuICAgICAgICB0aW1lRWxhcHNlZDogJycsXG4gICAgICAgIHN0YXJ0VGltZVJlcTogMFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYm9va2luZ1NlcnZpY2U6IEJvb2tpbmdTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcm91dGVyRXh0ZW5zaW9uczogUm91dGVyRXh0ZW5zaW9ucykge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMucm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaENyaXRlcmlhID0gZSB8fCB7fTtcblxuICAgICAgICB9KVxuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlYXJjaCh0aGlzLnNlYXJjaENyaXRlcmlhKS5zdWJzY3JpYmUoKHJlc3ApID0+IHtcbiAgICAgICAgICAgIHRoaXMubGlzdERhdGEgPSByZXNwO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZWFyY2gobW9kZWwsIG5vUmVsb2FkPykge1xuICAgICAgICBpZighbm9SZWxvYWQpe1xuICAgICAgICAgICAgdGhpcy5idXN5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlYXJjaEluZm8uc3RhcnRUaW1lUmVxID0gKyhuZXcgRGF0ZSgpKTtcbiAgICAgICAgbGV0IGFycml2YWxEYXRlID0gK21vbWVudCgrbW9kZWwuYXJyaXZhbERhdGUpIHx8ICttb21lbnQobW9kZWwuYXJyaXZhbERhdGUpO1xuICAgICAgICBsZXQgZGVwYXJ0dXJlRGF0ZSA9ICttb21lbnQoK21vZGVsLmRlcGFydHVyZURhdGUpIHx8ICttb21lbnQobW9kZWwuZGVwYXJ0dXJlRGF0ZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLmJvb2tpbmdTZWFyY2hQcm9wZXJ0aWVzKFxuICAgICAgICAgICAgbW9tZW50KGFycml2YWxEYXRlKS5mb3JtYXQoQXBwQ29uc3RhbnQudHlwZUZvcm1hdC5kYXRlKSxcbiAgICAgICAgICAgIG1vbWVudChkZXBhcnR1cmVEYXRlKS5mb3JtYXQoQXBwQ29uc3RhbnQudHlwZUZvcm1hdC5kYXRlKSxcbiAgICAgICAgICAgIG1vZGVsLm51bWJlck9mUEFYLFxuICAgICAgICAgICAgJycsXG4gICAgICAgICAgICAnMCcsXG4gICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgdGhpcy5wYWdpbmcucGFnZUluZGV4ICsgMSxcbiAgICAgICAgICAgIHRoaXMucGFnaW5nLnBhZ2VTaXplXG4gICAgICAgIClcbiAgICAgICAgICAgIC5tYXAoKHJlc3A6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmKCFub1JlbG9hZCl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVzeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEluZm8uc2VhcmNoaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJbmZvLnRpbWVFbGFwc2VkID0gKCgoK25ldyBEYXRlKCkpIC0gdGhpcy5zZWFyY2hJbmZvLnN0YXJ0VGltZVJlcSkgLyAxMDAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5mby5zdGFydFRpbWVSZXEgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWwgPSByZXNwLmRhdGEudG90YWw7XG4gICAgICAgICAgICAgICAgdGhpcy5saXN0RGF0YSA9IFsuLi5yZXNwLmRhdGEuZW50aXRpZXMsIC4uLnJlc3AuZGF0YS5lbnRpdGllcywgLi4ucmVzcC5kYXRhLmVudGl0aWVzLCAuLi5yZXNwLmRhdGEuZW50aXRpZXMsIC4uLnJlc3AuZGF0YS5lbnRpdGllcywgLi4ucmVzcC5kYXRhLmVudGl0aWVzLCAuLi5yZXNwLmRhdGEuZW50aXRpZXMsIC4uLnJlc3AuZGF0YS5lbnRpdGllcywgLi4ucmVzcC5kYXRhLmVudGl0aWVzLCAuLi5yZXNwLmRhdGEuZW50aXRpZXMsIC4uLnJlc3AuZGF0YS5lbnRpdGllc107XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3AuZGF0YS5lbnRpdGllcztcbiAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEluZm8uc2VhcmNoaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJbmZvLnRpbWVFbGFwc2VkID0gKCgoK25ldyBEYXRlKCkpIC0gdGhpcy5zZWFyY2hJbmZvLnN0YXJ0VGltZVJlcSkgLyAxMDAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5mby5zdGFydFRpbWVSZXEgPSAwO1xuICAgICAgICAgICAgfSlcbiAgICB9XG5cbiAgICBwdWJsaWMgZ29CYWNrKCkge1xuICAgICAgICB0aGlzLnJvdXRlckV4dGVuc2lvbnMuYmFja1RvUHJldmlvdXNQYWdlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uSXRlbVRhcChhcmdzKSB7XG4gICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLmxpc3REYXRhW2FyZ3MuaW5kZXhdO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJ2hvdGVsLWRldGFpbCddLCB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtczoge1xuICAgICAgICAgICAgICAgIC4uLnRoaXMuc2VhcmNoQ3JpdGVyaWEsXG4gICAgICAgICAgICAgICAgaWQ6IHNlbGVjdGVkSXRlbS5pZFxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbiAmJiB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICBpZiAoZ2xvYmFsLmFuZHJvaWQpIHtcbiAgICAgICAgICAgIChnbG9iYWwgYXMgYW55KS5nYygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uUHVsbFRvUmVmcmVzaEluaXRpYXRlZChhcmdzKSB7XG4gICAgICAgIGNvbnN0IGxpc3RWaWV3ID0gYXJncy5vYmplY3Q7XG4gICAgICAgIHRoaXMuc2VhcmNoKHRoaXMuc2VhcmNoQ3JpdGVyaWEsIHRydWUpLnN1YnNjcmliZSgocmVzcCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5saXN0RGF0YSA9IHJlc3A7XG4gICAgICAgICAgICBsaXN0Vmlldy5ub3RpZnlQdWxsVG9SZWZyZXNoRmluaXNoZWQoKTtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgbGlzdFZpZXcubm90aWZ5UHVsbFRvUmVmcmVzaEZpbmlzaGVkKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0iXX0=